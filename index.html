<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CSE 60-F | CR Dashboard Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶π‡ßÅ‡¶¨‡¶π‡ßÅ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá */
        :root {
            --primary: #0f172a; --secondary: #1e293b; --accent: #f97316;
            --bg: #f8fafc; --white: #ffffff; --glass: rgba(255, 255, 255, 0.85);
            --green: #10b981; --red: #ef4444; --blue: #3b82f6;
            --lab-bg: #ecfdf5; --notice-bg: #fff7ed;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); color: #334155; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 40px; }
        header { width: 100%; background: var(--primary); color: white; padding: 30px 0; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.15); border-bottom: 4px solid var(--accent); margin-bottom: 25px; }
        header h1 { margin: 0; font-size: 1.8rem; letter-spacing: -0.5px; font-weight: 700; }
        #live-date { font-weight: 300; opacity: 0.8; margin-top: 5px; font-size: 0.9rem; }
        .notice-bar { width: 92%; max-width: 700px; background: var(--notice-bg); border-left: 5px solid var(--accent); border-radius: 8px; color: #9a3412; margin: 0 auto 20px auto; padding: 15px 20px; display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); animation: slideIn 0.5s ease; box-sizing: border-box; }
        .card { background: var(--glass); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); width: 92%; max-width: 700px; margin: 15px 0; padding: 25px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: var(--shadow); text-align: center; box-sizing: border-box; }
        .timer { font-size: 2.5rem; font-weight: 800; color: var(--primary); background: #f1f5f9; display: inline-block; padding: 5px 20px; border-radius: 12px; }
        .nav-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 92%; max-width: 700px; margin: 10px 0 25px 0; }
        .btn { padding: 14px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; color: white; }
        .content-section { display: none; width: 95%; max-width: 1000px; margin-top: 10px; }
        table { width: 100%; border-collapse: separate; background: var(--white); border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); }
        th { background: var(--primary); color: white; padding: 15px; font-size: 0.8rem; }
        td { padding: 15px 10px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; text-align: center; }
        .lab-highlight { background: var(--lab-bg) !important; color: #065f46; font-weight: 600; }
    </style>
</head>
<body>

<header>
    <h1>CSE Batch 60-F Dashboard</h1>
    <div id="live-date">Loading...</div>
</header>

<div id="notice-bar" class="notice-bar" style="display:none;">
    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="orange" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
    <div class="notice-text" id="notice-text-display"></div>
</div>

<div class="card">
    <div style="color:var(--accent); font-weight:700; font-size:0.8rem; margin-bottom:10px;">UPCOMING SESSION</div>
    <div id="next-class-name" style="font-size:1.2rem; font-weight:700; margin-bottom:10px;">Searching...</div>
    <div id="countdown-timer" class="timer">00h 00m 00s</div>
</div>

<div id="active-tasks-container" class="card" style="display: none;">
    <div style="border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom:15px; font-weight:700;">üì¢ Tasks & Exams</div>
    <div id="task-board"></div>
</div>

<div class="nav-grid">
    <button class="btn" style="background:var(--primary)" onclick="show('full-table')">Routine</button>
    <button class="btn" style="background:var(--secondary)" onclick="show('teacher-info')">Teachers</button>
    <button class="btn" style="background:var(--green)" onclick="tryShowProtectedSection('attendance-section')">Attendance</button>
    <button class="btn" style="background:#64748b" onclick="tryShowProtectedSection('edit-panel')">Settings</button>
</div>

<div id="full-table" class="content-section">
    <div style="overflow-x: auto;">
        <table>
            <thead><tr><th>Time</th><th>Sat</th><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th></tr></thead>
            <tbody id="routine-body"></tbody>
        </table>
    </div>
</div>

<div id="teacher-info" class="content-section">
    <div id="teacher-list"></div>
</div>

<div id="edit-panel" class="content-section">
    <div class="card" style="text-align: left;">
        <h3>Admin Control Panel</h3>
        <label>Global Notice</label>
        <textarea id="notice-text-input" style="width:100%; height:50px;"></textarea>
        <label>Teacher Data (JSON)</label>
        <textarea id="json-teachers" style="width:100%; height:100px;"></textarea>
        <label>Routine Data (JSON)</label>
        <textarea id="json-classes" style="width:100%; height:100px;"></textarea>
        <button class="btn" style="background:var(--green); width:100%; margin-top:10px;" onclick="saveData()">Update for All Users</button>
    </div>
</div>

<script>
    // 1. Firebase Configuration (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ)
    const firebaseConfig = {
        apiKey: "AIzaSyDi6GkHtLaMqIQIQXkEk9g80iQmFrCyqs",
        authDomain: "cse-60f-dashboard-56f50.firebaseapp.com",
        databaseURL: "https://cse-60f-dashboard-56f50-default-rtdb.firebaseio.com",
        projectId: "cse-60f-dashboard-56f50",
        storageBucket: "cse-60f-dashboard-56f50.firebasestorage.app",
        messagingSenderId: "213274939346",
        appId: "1:213274939346:web:6d1adccc19a4d02ef4c20b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const dashboardRef = db.ref('dashboardData');

    const PROTECTED_PASSWORD = '1322';
    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    // ‡ß®. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ appData (‡¶Ø‡¶¶‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶è‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá)
    let appData = {
        teachers: [
            { name: "Rupak Sir", courses: "Software, Lab", email: "rupak@uni.com", phone: "+88017...", classroom: "abc" }
        ],
        classes: {
            "MON_0845": { sub: "SOFTWARE Lab", tea: "Rupak Sir", room: "612", isLab: true }
        },
        noticeText: "Welcome to CSE 60-F Dashboard!",
        tasks: []
    };

    // ‡ß©. ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï‡¶ø‡¶Ç (‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ)
    dashboardRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            appData = data;
            renderDashboard();
        }
    });

    function renderDashboard() {
        document.getElementById('live-date').innerText = new Date().toDateString();
        
        // Notice bar
        if (appData.noticeText) {
            document.getElementById('notice-text-display').textContent = appData.noticeText;
            document.getElementById('notice-bar').style.display = 'flex';
        }

        // Teachers
        document.getElementById('teacher-list').innerHTML = appData.teachers.map(t => `
            <div style="background:white; padding:15px; border-radius:10px; margin-bottom:10px; border-left:5px solid orange;">
                <strong>${t.name}</strong><br><small>${t.courses} | Room: ${t.classroom}</small>
            </div>
        `).join('');

        // Routine Rendering Logic (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡ßÆ‡ß™‡ß¨ ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá)
        const routineStructure = [
            { time: "08:45-10:05", start: "08:45", Mon: "MON_0845", Tue: "TUE_0845", Thu: "THU_0845" },
            { time: "11:25-12:45", start: "11:25", Mon: "MON_1125", Tue: "TUE_1125" }
        ];

        const tbody = document.getElementById('routine-body');
        tbody.innerHTML = '';
        routineStructure.forEach(slot => {
            let row = `<tr><td style="font-weight:700;">${slot.time}</td>`;
            ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu'].forEach(day => {
                const info = appData.classes[slot[day]];
                if (info) {
                    row += `<td class="${info.isLab ? 'lab-highlight' : ''}">${info.sub}<br><small>${info.room}</small></td>`;
                } else row += '<td>-</td>';
            });
            tbody.innerHTML += row + '</tr>';
        });
    }

    // ‡ß™. ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Ø‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡ßÅ‡¶∂ ‡¶ï‡¶∞‡¶¨‡ßá)
    function saveData() {
        try {
            appData.teachers = JSON.parse(document.getElementById('json-teachers').value);
            appData.classes = JSON.parse(document.getElementById('json-classes').value);
            appData.noticeText = document.getElementById('notice-text-input').value;

            dashboardRef.set(appData).then(() => {
                alert("‡¶∏‡¶¨‡¶æ‡¶á‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá!");
                show('full-table');
            });
        } catch (e) { alert("JSON Format ‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
    }

    function show(id) {
        document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function tryShowProtectedSection(id) {
        if (prompt("CR Password:") === PROTECTED_PASSWORD) {
            show(id);
            if(id === 'edit-panel') {
                document.getElementById('json-teachers').value = JSON.stringify(appData.teachers, null, 2);
                document.getElementById('json-classes').value = JSON.stringify(appData.classes, null, 2);
                document.getElementById('notice-text-input').value = appData.noticeText;
            }
        } else alert("Wrong Password!");
    }

    window.onload = () => { show('full-table'); };
</script>
</body>
</html>
